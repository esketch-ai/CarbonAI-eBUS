# 00_chatbot_embeddings.md - 챗봇 임베딩 문서 (질의응답 및 지식 기반)

이 문서는 프로젝트 관련 챗봇의 질의응답 및 신입 교육을 위한 지식 기반으로 활용됩니다.
각 섹션은 챗봇이 사용자 질문에 답변하는 데 필요한 핵심 정보를 포함합니다.

---

## 1. 프로젝트 개요 및 목적

**Q:** 이 프로젝트의 주요 목적은 무엇인가요?
**A:** 이 프로젝트는 버스 운행 기록 데이터를 활용하여 각 차량의 베이스라인 인자(연평균 주행거리, 연평평 주유량, 연비 등)를 산출하고 관리하는 시스템입니다. 버스 운영 효율성 분석 및 친환경 차량 전환 계획 수립을 위한 기초 데이터를 제공하는 것이 목표입니다.

**Q:** 이 시스템을 통해 어떤 정보를 얻을 수 있나요?
**A:** 각 버스 차량의 월별 운행 기록, 베이스라인 연비, 연평균 주행거리, 연평균 연료 주입량, 그리고 전기버스 전환에 따른 CO2 감축량 등의 정보를 얻을 수 있습니다.

---

## 2. 기술 스택 및 개발 환경

**Q:** 이 프로젝트는 어떤 기술 스택을 사용하나요?
**A:** Python 3.x, 데이터 처리를 위한 Pandas 및 NumPy, 데이터베이스는 PostgreSQL, DB 연결을 위해 Psycopg2 라이브러리를 사용합니다.

**Q:** 개발 환경을 설정하려면 어떻게 해야 하나요?
**A:** Python 3.x와 PostgreSQL을 설치하고, `pip install pandas numpy psycopg2-binary` 명령으로 필요한 Python 라이브러리를 설치해야 합니다. 또한, `db_config.py` 파일에 PostgreSQL 연결 정보를 올바르게 설정해야 합니다.

---

## 3. 데이터베이스 스키마 및 테이블

**Q:** 프로젝트의 주요 데이터베이스 테이블은 무엇인가요?
**A:** 주요 테이블은 `bus_vehicle_master` (차량 기본 정보), `bus_driving_records` (월별 운행 기록), `bus_baseline_parameters` (베이스라인 인자), `bus_emission_reductions` (CO2 감축량)입니다.

**Q:** `bus_vehicle_master` 테이블은 어떤 정보를 담고 있나요?
**A:** `bus_vehicle_master` 테이블은 모든 버스 차량의 고유 차량번호, 업체명, 연식, 사업구분, 전기차량 등록일, 기존 연료 타입, 차대번호, 그리고 대체 전후 버스 간의 관계(replaced_by_ev_plate_no, original_ice_plate_no)와 같은 기본 정보를 저장합니다.

**Q:** `bus_driving_records` 테이블은 어떤 정보를 담고 있나요?
**A:** `bus_driving_records` 테이블은 각 차량의 월별 운행 일수, 운행 거리, 주유량과 같은 상세 운행 기록을 저장합니다. `vehicle_plate_no`를 통해 `bus_vehicle_master`와 연결됩니다.

**Q:** `bus_baseline_parameters` 테이블은 어떤 정보를 담고 있나요?
**A:** `bus_baseline_parameters` 테이블은 각 차량의 베이스라인 인자, 즉 베이스라인 산정에 사용된 월의 수, 연평균 주행거리, 연평균 연료 주입량, km당 연료 사용량(연비)을 저장합니다. `vehicle_plate_no`를 통해 `bus_vehicle_master`와 연결됩니다.

**Q:** `bus_emission_reductions` 테이블은 어떤 정보를 담고 있나요?
**A:** `bus_emission_reductions` 테이블은 각 차량의 CO2 감축량 계산 결과를 저장합니다. 여기에는 계산된 연도, 베이스라인 연료 소비량, 배출 계수, 베이스라인 CO2 배출량, 실제 전기차 CO2 배출량(0), 최종 감축량, 그리고 감축량 산정 카테고리(대체버스 감축, 신규버스 미산정 등)가 포함됩니다. `vehicle_plate_no`를 통해 `bus_vehicle_master`와 연결됩니다.

---

## 4. 스크립트 기능 및 실행 순서

**Q:** 데이터베이스 스키마를 초기화하고 싶으면 어떤 스크립트를 실행해야 하나요?
**A:** `00_edit_db.py` 스크립트를 실행하면 됩니다. 이 스크립트는 모든 프로젝트 관련 테이블을 삭제하고 새로 생성합니다. **기존 데이터가 모두 삭제되니 주의해야 합니다.**

**Q:** 가상 데이터를 생성하고 DB에 적재하는 스크립트는 무엇인가요?
**A:** `01_insert_monthly_data.py` 스크립트입니다. 이 스크립트는 차량 마스터 데이터와 월별 운행 기록 데이터를 생성하여 DB에 적재합니다.

**Q:** 베이스라인 인자를 계산하는 스크립트는 무엇인가요?
**A:** `02_calculate_baseline.py` 스크립트입니다. 이 스크립트는 월별 운행 기록과 차량 마스터 정보를 기반으로 베이스라인 인자를 계산하고 DB에 저장합니다.

**Q:** 계산된 베이스라인 인자를 확인하려면 어떤 스크립트를 실행해야 하나요?
**A:** `03_display_baseline.py` 스크립트입니다. 이 스크립트는 DB에 저장된 베이스라인 인자를 조회하여 콘솔에 출력합니다.

**Q:** CO2 감축량을 계산하는 스크립트는 무엇인가요?
**A:** `04_calculate_business_target.py` 스크립트입니다. 이 스크립트는 베이스라인 인자와 차량 마스터 정보를 기반으로 CO2 감축량을 계산하고 DB에 저장합니다.

**Q:** 스크립트들을 실행하는 올바른 순서는 무엇인가요?
**A:** `run_all.py`를 실행하여 전체 파이프라인을 자동으로 실행하는 것을 권장합니다. 수동으로 실행할 경우, 논리적인 데이터 흐름에 따라 `00_edit_db.py` (필요시) -> `01_insert_monthly_data.py` -> `02_calculate_baseline.py` -> `04_calculate_business_target.py` -> `03_display_baseline.py` (결과 확인) 순서로 실행해야 합니다.

---

## 5. 감축량 산정 로직

**Q:** 대체 버스의 CO2 감축량은 어떻게 계산되나요?
**A:** 대체 버스는 내연기관 차량이 전기버스로 대체된 경우를 의미합니다. `02_calculate_baseline.py`에서 계산된 '베이스라인 연평균 연료 주입량(avg_annual_fuel_l)' 값에 해당 차량의 '기존 연료 타입(original_fuel_type)'에 맞는 CO2 배출계수를 곱하여 기존 내연기관 버스의 연간 CO2 배출량(베이스라인 배출량)을 계산합니다. 전기 버스의 직접 배출량은 0으로 간주하므로, 이 베이스라인 배출량이 곧 CO2 감축량이 됩니다.

**Q:** 신규 버스의 CO2 감축량은 어떻게 처리되나요?
**A:** 신규 버스는 대체 없이 도입된 전기버스를 의미합니다. 현재는 감축량을 '미산정'으로 표시합니다. 향후 유사한 내연기관 버스의 값을 구하여 감축량을 산정하는 로직이 추가될 예정입니다.

---

## 6. 에러 처리 및 디버깅

**Q:** 데이터베이스 연결 오류가 발생하면 어떻게 해야 하나요?
**A:** `db_config.py` 파일의 DB 연결 정보(host, dbname, user, password, port)가 올바른지 확인하고, PostgreSQL 서버가 실행 중인지 확인해야 합니다.

**Q:** '조회된 데이터가 없습니다'라는 메시지가 나오면 어떻게 해야 하나요?
**A:** 해당 데이터를 생성하고 DB에 적재하는 이전 스크립트(`01_insert_monthly_data.py`, `02_calculate_baseline.py`, `04_calculate_business_target.py`)가 정상적으로 실행되었는지 확인해야 합니다. `00_edit_db.py`를 실행하여 DB를 초기화한 후 모든 스크립트를 순서대로 다시 실행해보는 것이 좋습니다.

**Q:** `invalid input syntax for type timestamp: "NaT"`와 같은 오류가 발생하면 어떻게 해야 하나요?
**A:** 이는 데이터 타입 불일치로 인해 발생합니다. 특히 날짜/시간 관련 컬럼에 `None` 또는 `NaT` 값이 들어갈 때 DB가 인식하지 못하는 형식일 수 있습니다. 해당 스크립트에서 데이터프레임의 해당 컬럼을 `pd.to_datetime`으로 변환하고, `pd.NaT` 값을 `None`으로 명시적으로 처리하는지 확인해야 합니다.
