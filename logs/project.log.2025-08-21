2025-08-21 13:53:40,164 - GHGERC_BUS_PROJECT - INFO - ===== 🚌 Bus CO2 Reduction Calculation Pipeline Start =====
2025-08-21 13:53:42,235 - GHGERC_BUS_PROJECT - INFO - ============================================================
2025-08-21 13:53:42,235 - GHGERC_BUS_PROJECT - INFO - 🚀 Executing: 00_edit_db.py
2025-08-21 13:53:42,236 - GHGERC_BUS_PROJECT - INFO - ============================================================
2025-08-21 13:53:44,499 - GHGERC_BUS_PROJECT - INFO - --- Output from 00_edit_db.py ---
--- [파일 00] 데이터베이스 스키마 관리 시작 ---
⏳ 데이터베이스에 연결을 시도합니다...
✅ 데이터베이스 연결에 성공했습니다!

--- 기존 테이블 삭제 및 새 테이블 생성 시작 ---
✅ 테이블 삭제: EXISTS 성공적으로 실행되었습니다.
✅ 테이블 삭제: EXISTS 성공적으로 실행되었습니다.
✅ 테이블 삭제: EXISTS 성공적으로 실행되었습니다.
✅ 테이블 삭제: EXISTS 성공적으로 실행되었습니다.
✅ 'bus_vehicle_master' 테이블 생성 성공적으로 실행되었습니다.
✅ 'bus_driving_records' 테이블 생성 성공적으로 실행되었습니다.
✅ 'bus_baseline_parameters' 테이블 생성 성공적으로 실행되었습니다.
✅ 'bus_emission_reductions' 테이블 생성 성공적으로 실행되었습니다.
--- 기존 테이블 삭제 및 새 테이블 생성 완료 ---

✅ 데이터베이스 연결을 닫았습니다.
2025-08-21 13:53:44,499 - GHGERC_BUS_PROJECT - INFO - ✅ Success: '00_edit_db.py' finished successfully.
2025-08-21 13:53:44,499 - GHGERC_BUS_PROJECT - INFO - ============================================================
2025-08-21 13:53:44,500 - GHGERC_BUS_PROJECT - INFO - 🚀 Executing: 01_insert_monthly_data.py
2025-08-21 13:53:44,500 - GHGERC_BUS_PROJECT - INFO - ============================================================
2025-08-21 13:53:48,428 - GHGERC_BUS_PROJECT - INFO - --- Output from 01_insert_monthly_data.py ---
--- [파일 1] 월별 운행 기록 데이터 생성 및 DB 적재 시작 ---
✅ 가상 데이터 생성 및 정제를 완료했습니다.
✅ 생성된 데이터를 엑셀 파일로 저장했습니다: generated_data\generated_bus_data_20250821_135346.xlsx
⏳ 데이터베이스에 연결을 시도합니다...
✅ 데이터베이스 연결에 성공했습니다!
⏳ 'bus_vehicle_master' 테이블에 차량 마스터 데이터를 저장/업데이트합니다...
✅ 40개의 차량 마스터 레코드가 성공적으로 저장/업데이트되었습니다.
⏳ 'bus_driving_records' 테이블에 월별 데이터를 저장/업데이트합니다...
✅ 44개의 월별 운행 기록 레코드가 성공적으로 저장/업데이트되었습니다.
⏳ 'bus_monthly_fuel_data' 테이블에 월별 연료 데이터를 저장/업데이트합니다...
✅ 44개의 월별 연료 기록 레코드가 성공적으로 삽입/업데이트되었습니다.

✅ 데이터베이스 연결을 닫았습니다.
2025-08-21 13:53:48,428 - GHGERC_BUS_PROJECT - INFO - ✅ Success: '01_insert_monthly_data.py' finished successfully.
2025-08-21 13:53:48,428 - GHGERC_BUS_PROJECT - INFO - ============================================================
2025-08-21 13:53:48,428 - GHGERC_BUS_PROJECT - INFO - 🚀 Executing: 02_calculate_baseline.py
2025-08-21 13:53:48,428 - GHGERC_BUS_PROJECT - INFO - ============================================================
2025-08-21 13:53:49,339 - GHGERC_BUS_PROJECT - INFO - --- Output from 02_calculate_baseline.py ---
--- [파일 2] 베이스라인 인자 계산 및 DB 적재 시작 ---
⏳ 데이터베이스에 연결을 시도합니다...
✅ 데이터베이스 연결에 성공했습니다!
⏳ 'bus_monthly_fuel_data' 테이블에서 데이터를 로드합니다...
✅ 2240개의 'bus_monthly_fuel_data' 데이터를 성공적으로 로드했습니다.
⏳ 'bus_vehicle_master' 테이블에서 데이터를 로드합니다...
✅ 40개의 'bus_vehicle_master' 데이터를 성공적으로 로드했습니다.
✅ 베이스라인 계산 대상 내연기관 차량 29대에 대한 데이터 1152개를 로드했습니다.
⚠️ 차량 서울74사1909: 유효한 월별 연료/거리 데이터가 없어 베이스라인을 계산할 수 없습니다.
⚠️ 차량 서울74사4950: 유효한 월별 연료/거리 데이터가 없어 베이스라인을 계산할 수 없습니다.
⚠️ 차량 서울74사5031: 유효한 월별 연료/거리 데이터가 없어 베이스라인을 계산할 수 없습니다.
⚠️ 차량 서울74사5185: 유효한 월별 연료/거리 데이터가 없어 베이스라인을 계산할 수 없습니다.
⚠️ 차량 서울74사5431: 유효한 월별 연료/거리 데이터가 없어 베이스라인을 계산할 수 없습니다.
⚠️ 차량 서울74사6467: 유효한 월별 연료/거리 데이터가 없어 베이스라인을 계산할 수 없습니다.
⚠️ 차량 서울74사6580: 베이스라인 계산에 필요한 최소 3년(36개월)치 데이터가 부족합니다 (34개월). 베이스라인을 계산하지 않습니다.
⚠️ 차량 서울74사6629: 유효한 월별 연료/거리 데이터가 없어 베이스라인을 계산할 수 없습니다.
⚠️ 차량 서울74사7592: 유효한 월별 연료/거리 데이터가 없어 베이스라인을 계산할 수 없습니다.
⚠️ 차량 서울74사8725: 유효한 월별 연료/거리 데이터가 없어 베이스라인을 계산할 수 없습니다.
⚠️ 차량 서울74사9968: 유효한 월별 연료/거리 데이터가 없어 베이스라인을 계산할 수 없습니다.
✅ 베이스라인 인자 계산을 완료했습니다.
⏳ 'bus_baseline_parameters' 테이블에 데이터를 저장/업데이트합니다...
❌ 베이스라인 데이터 저장 오류: column "baseline_co2_emission_kg" of relation "bus_baseline_parameters" does not exist
LINE 2: ...distance_km", "avg_annual_fuel_l", "fuel_per_km", "baseline_...
                                                             ^


✅ 데이터베이스 연결을 닫았습니다.
2025-08-21 13:53:49,340 - GHGERC_BUS_PROJECT - INFO - ✅ Success: '02_calculate_baseline.py' finished successfully.
2025-08-21 13:53:49,340 - GHGERC_BUS_PROJECT - INFO - ============================================================
2025-08-21 13:53:49,340 - GHGERC_BUS_PROJECT - INFO - 🚀 Executing: 04_calculate_business_target.py
2025-08-21 13:53:49,340 - GHGERC_BUS_PROJECT - INFO - ============================================================
2025-08-21 13:53:49,975 - GHGERC_BUS_PROJECT - INFO - --- Output from 04_calculate_business_target.py ---
--- [파일 4] 사업 목표 감축량 계산 시작 ---
⏳ 데이터베이스에 연결을 시도합니다...
✅ 데이터베이스 연결에 성공했습니다!
⏳ 	'bus_baseline_parameters' 테이블에서 데이터를 로드합니다...
✅ 0개의 	'bus_baseline_parameters' 데이터를 성공적으로 로드했습니다.
⏳ 	'bus_vehicle_master' 테이블에서 데이터를 로드합니다...
✅ 40개의 	'bus_vehicle_master' 데이터를 성공적으로 로드했습니다.
⚠️ 필요한 데이터(베이스라인 또는 차량 마스터)가 없습니다. 01, 02번 스크립트를 먼저 실행해주세요.
2025-08-21 13:53:49,976 - GHGERC_BUS_PROJECT - INFO - ✅ Success: '04_calculate_business_target.py' finished successfully.
2025-08-21 13:53:49,976 - GHGERC_BUS_PROJECT - INFO - ============================================================
2025-08-21 13:53:49,976 - GHGERC_BUS_PROJECT - INFO - 🚀 Executing: 05_co2_reduction_calc.py
2025-08-21 13:53:49,976 - GHGERC_BUS_PROJECT - INFO - ============================================================
2025-08-21 13:53:50,603 - GHGERC_BUS_PROJECT - INFO - --- Output from 05_co2_reduction_calc.py ---
--- [파일 5] 상세 CO2 감축량 계산 시작 (엑셀 로직 기반) ---
⏳ 데이터베이스에 연결을 시도합니다...
✅ 데이터베이스 연결에 성공했습니다!
⏳ 감축량 계산을 위해 'bus_baseline_parameters'와 'bus_vehicle_master' 테이블에서 데이터를 로드합니다...
❌ 데이터 로드 중 오류 발생: Execution failed on sql '
        SELECT
            vm.vehicle_plate_no,
            vm.business_type,
            vm.ev_registration_date,
            vm.original_fuel_type,
            bp.avg_annual_fuel_l, -- 베이스라인 연간 연료 소비량
            bp.baseline_co2_emission_kg, -- 베이스라인 CO2 배출량 (02_calculate_baseline.py에서 계산됨)
            bp.baseline_emission_factor, -- 베이스라인 배출계수 (02_calculate_baseline.py에서 계산됨)
            bmfd.distance_km AS ev_latest_month_distance_km -- 전기차의 최신 월별 주행 거리
        FROM
            bus_vehicle_master vm
        JOIN
            bus_baseline_parameters bp ON vm.original_ice_plate_no = bp.vehicle_plate_no -- 대체된 내연기관 차량의 베이스라인 조인
        LEFT JOIN LATERAL (
            SELECT
                bmfd_sub.distance_km,
                bmfd_sub.record_year_month
            FROM
                bus_monthly_fuel_data bmfd_sub
            WHERE
                bmfd_sub.vehicle_plate_no = vm.vehicle_plate_no
            ORDER BY
                bmfd_sub.record_year_month DESC
            LIMIT 1
        ) AS bmfd ON vm.vehicle_plate_no IS NOT NULL -- 전기차량에 대해서만 조인 시도
        WHERE
            vm.ev_registration_date IS NOT NULL
            AND vm.business_type = '대체도입';
        ': column bp.baseline_co2_emission_kg does not exist
LINE 8:             bp.baseline_co2_emission_kg, -- 베이스라인 CO2 ...
                    ^


✅ 데이터베이스 연결을 닫았습니다.
2025-08-21 13:53:50,603 - GHGERC_BUS_PROJECT - INFO - ✅ Success: '05_co2_reduction_calc.py' finished successfully.
2025-08-21 13:53:50,603 - GHGERC_BUS_PROJECT - INFO - ============================================================
2025-08-21 13:53:50,603 - GHGERC_BUS_PROJECT - INFO - 🚀 Executing: 03_display_baseline.py
2025-08-21 13:53:50,603 - GHGERC_BUS_PROJECT - INFO - ============================================================
2025-08-21 13:53:51,242 - GHGERC_BUS_PROJECT - INFO - --- Output from 03_display_baseline.py ---
--- [파일 3] 베이스라인 인자 조회 및 출력 시작 ---
⏳ 데이터베이스에 연결을 시도합니다...
✅ 데이터베이스 연결에 성공했습니다!

⏳ 베이스라인 인자 및 차량 마스터 데이터를 조회합니다...
⏳ 'bus_baseline_parameters' 테이블에서 데이터를 로드합니다...
✅ 0개의 'bus_baseline_parameters' 데이터를 성공적으로 로드했습니다.
⏳ 'bus_vehicle_master' 테이블에서 데이터를 로드합니다...
✅ 40개의 'bus_vehicle_master' 데이터를 성공적으로 로드했습니다.
⚠️ 조회된 데이터가 없습니다. 01, 02번 스크립트를 먼저 실행했는지 확인해주세요.

✅ 데이터베이스 연결을 닫았습니다.
2025-08-21 13:53:51,242 - GHGERC_BUS_PROJECT - INFO - ✅ Success: '03_display_baseline.py' finished successfully.
2025-08-21 13:53:51,242 - GHGERC_BUS_PROJECT - INFO - ============================================================
2025-08-21 13:53:51,242 - GHGERC_BUS_PROJECT - INFO - 🚀 Executing: 06_Report.py
2025-08-21 13:53:51,243 - GHGERC_BUS_PROJECT - INFO - ============================================================
2025-08-21 13:53:52,252 - GHGERC_BUS_PROJECT - INFO - --- Output from 06_Report.py ---
--- [파일 6] 종합 분석 보고서(Excel) 생성 시작 ---
⏳ 데이터베이스에 연결을 시도합니다...
✅ 데이터베이스 연결에 성공했습니다!
⏳ [1/3] 종합 보고서 데이터를 로드합니다...
⏳ [2/3] 월별 운행기록 데이터를 로드합니다...
⏳ [3/3] 베이스라인 계산결과 데이터를 로드합니다...

⏳ 생성된 보고서를 Excel 파일로 저장합니다: reports\bus_analysis_report_20250821_135352.xlsx
✅ 보고서 저장이 완료되었습니다: reports\bus_analysis_report_20250821_135352.xlsx

✅ 데이터베이스 연결을 닫았습니다.
2025-08-21 13:53:52,252 - GHGERC_BUS_PROJECT - INFO - ✅ Success: '06_Report.py' finished successfully.
2025-08-21 13:53:52,252 - GHGERC_BUS_PROJECT - INFO - 🎉🎉🎉 All scripts executed successfully! Pipeline finished. 🎉🎉🎉
